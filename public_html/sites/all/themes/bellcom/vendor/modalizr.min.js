// |--------------------------------------------------------------------------
// | Modalizr
// |--------------------------------------------------------------------------
// |
// | This jQuery script is written by
// | Morten Nissen
// |
// | And enhances the Bootstrap modal. Furthermore adds functionality such as:
// | - alert
// | - confirm
// | - auto closing (with countdown)
// | - timed redirect
// |


    var modalizr = {


        // Set default configurations
        config: {
            centered:                               false
        },




        // |-------------------------------------------
        // | Create
        // |-------------------------------------------
        // |
        // | Creates a modal with one button. The 
        // | button closes the modal on click.
        // |


        create: function( config ) {


            // Override default configurations
            jQuery.extend( modalizr.config, config );


            // Get configurations
            var config                          =   modalizr.config,
                modal                           =   modalizr.createModal();


            // Modal have not been set - return
            if( ! modal ) return false;


            // Insert modal into DOM
            if( ! modalizr.insertModal( modal ) ) return false;


            // Show modal
            modalizr.show();


        },


        // Insert modal
        insertModal: function( modal ) {


            // Insert into DOM
            jQuery( "body" ).prepend( modal );


            // Re-position modal
            modalizr.repositionModal( modal );


            // Return
            return true;


        },


        // Show modalizr
        show: function() {


            // Get configurations
            var config                          =   modalizr.config;


            // Show animation
            jQuery( "#modalizr" ).on( "show.bs.modal", function() {
                jQuery( this )
                    .addClass( "show-animation" );

            });


            // Remove animation
            jQuery( "#modalizr" ).on( "hide.bs.modal", function() {
                jQuery( this )
                    .removeClass( "show-animation" )
                    .addClass( "remove-animation" );
            });


            // Instantiate
            jQuery( "#modalizr" ).modal({
                backdrop:                           "static",
                keyboard:                           false,
                show:                               true
            });


            // Remove HTML when done hiding
            jQuery( "#modalizr" ).on( "hidden.bs.modal", function () {
                jQuery( this ).remove();
                jQuery( "body" ).removeClass( "modal-open" );
            });


        },




        // |-------------------------------------------
        // | Create modal objects
        // |-------------------------------------------
        // |
        // | Creates the different modal objects, such as:
        // | Dialog, content, header, body, footer.
        // |


        // Create modal
        createModal: function() {


            // Get configurations
            var config                          =   modalizr.config,
                centered                        =   config.centered,
                dialog                          =   modalizr.createModalDialog();


            // Create jQuery object
            var modal                           =   jQuery( "<div />" )
                                                        .attr( "id", "modalizr" )
                                                        .addClass( "modal" )
                                                        .addClass( "fade" );


            // Add centered content
            if( centered ) modal.addClass( "modal-centered" );


            // Add dialog
            modal.html( dialog );


            // Return modal
            return modal;


        },


        // Create modal dialog
        createModalDialog: function() {


            // Get configurations
            var size                            =   modalizr.getConvertedSize(),
                content                         =   modalizr.createModalContent();


            // Create jQuery object
            var dialog                          =   jQuery( "<div />" )
                                                        .addClass( "modal-dialog" );


            // Add size
            if( size ) dialog.addClass( size );


            // Add content
            dialog.append( content );


            // Return dialog
            return dialog;


        },


        // Create modal content
        createModalContent: function() {


            // Get configurations
            var config                          =   modalizr.config,
                header                          =   modalizr.createModalHeader(),
                body                            =   modalizr.createModalBody(),
                footer                          =   modalizr.createModalFooter();


            // Header not set
            if( ! header || header == "" ) return false;


            // Body not set
            if( ! body || body == "" ) return false;


            // Footer not set
            if( ! footer || footer == "" ) return false;


            // Create jQuery object
            var content                         =   jQuery( "<div />" )
                                                        .addClass( "modal-content" );


            // Add header
            content.append( header );


            // Add body
            content.append( body );


            // Add footer
            content.append( footer );


            // Return content
            return content;


        },


        // Create modal header
        createModalHeader: function() {


            // Get configurations
            var config                          =   modalizr.config,
                title                           =   config.title;


            // Title not set
            if( ! title || title == "" ) return false;


            // Create jQuery object
            var header                          =   jQuery( "<div />" )
                                                        .addClass( "modal-header" );


            // Insert title
            jQuery( "<h4 />" )
                .addClass( "modal-title" )
                .html( title )
                .appendTo( header );


            // Return header
            return header;


        },


        // Create modal body
        createModalBody: function() {


            // Get configurations
            var config                          =   modalizr.config,
                text                            =   config.body;


            // Text not set
            if( ! text || text == "" ) return false;


            // Create jQuery object
            var body                            =   jQuery( "<div />" )
                                                        .addClass( "modal-body" );


            // Insert text
            body.html( text );


            // Return body
            return body;


        },


        // Create modal footer
        createModalFooter: function() {


            // Get configurations
            var config                          =   modalizr.config,
                buttons                         =   config.buttons;


            // Create jQuery object
            var footer                          =   jQuery( "<div />" )
                                                        .addClass( "modal-footer" );



            // Run through all buttons
            jQuery.each( config.buttons, function( index, button ) {


                // Insert button
                footer.append( modalizr.createButton( button ) );


            });


            // Return footer
            return footer;


        },


        // Create button
        createButton: function( config ) {


            // Set default configurations
            var value                           =   config.value,
                identifier                      =   config.identifier,
                callback                        =   config.callback,
                classes                         =   config.classes,
                close                           =   config.close,
                icon                            =   config.icon,
                loader                          =   config.loader;


            // Create jQuery object
            var button                          =   jQuery( "<button />" ).attr( "type", "button" )
                                                        .html( value );


            // Add ID (identifier)
            if( identifier ) button.attr( "id", identifier );


            // Add icon
            if( icon ) button.prepend( jQuery( "<span />" ).addClass( icon ) );


            // Add callback functionality
            if( callback ) button.on( "click", callback );


            // Add close functionality
            if( close ) button.attr( "data-dismiss", "modal" );


            // Add given classes
            if( classes ) button.addClass( classes );


            // Add default classes
            else button.addClass( "btn-default" );


            // Loader
            if( loader ) button.on( "click", function() { insertButtonLoader({ scope: jQuery( this ) }) } );


            // Return
            return button;


        },




        // |-------------------------------------------
        // | Alert modal
        // |-------------------------------------------
        // |
        // | Creates a modal with one button. The 
        // | button closes the modal on click.
        // |


        alert: function( locale ) {


            // Locale
            var title                           =   locale.title,
                body                            =   locale.body,
                button                          =   locale.button;


            // Create modal
            modalizr.create({
                size:                               "small",
                centered:                           true,
                title:                              title,
                body:                               body,
                buttons: {


                    // Button
                    button: {
                        value:                      button,
                        icon:                       "fa fa-check",
                        close:                      true,
                        classes:                    "btn btn-success"
                    }
                }
            });


        },




        // |-------------------------------------------
        // | Confirm modal
        // |-------------------------------------------
        // |
        // | Creates a modal with two buttons. An
        // | accept button with callback functionality,
        // | and a cancel button, which closes 
        // | the modal.
        // |


        confirm: function( options ) {


            // Locale
            var title                           =   options.title,
                body                            =   options.body,
                accept                          =   options.buttons.accept,
                cancel                          =   options.buttons.cancel;


            // Create modal
            modalizr.create({
                extraClass:                         "modal-centered",
                centered:                           true,
                title:                              title,
                body:                               body,
                buttons: {


                    // Accept button
                    buttonAccept: {
                        value:                      accept.value,
                        icon:                       "fa fa-check",
                        callback:                   accept.callback,
                        loader:                     true,
                        classes:                    "btn btn-success"
                    },


                    // Cancel button
                    buttonCancel: {
                        value:                      cancel.value,
                        icon:                       "fa fa-times",
                        close:                      true,
                        classes:                    "btn btn-danger"
                    }
                }
            });


        },




        // |-------------------------------------------
        // | Auto closing modal
        // |-------------------------------------------
        // |
        // | Creates a modal with two buttons. An
        // | accept button with callback functionality,
        // | and a cancel button, which closes 
        // | the modal.
        // |


        autoClosing: function( options ) {


            // Locale
            var duration                        =   options.duration,           // In miliseconds
                title                           =   options.title,
                body                            =   options.body;


            // Create modal
            modalizr.create({
                extraClass:                         "modal-centered",
                centered:                           true,
                title:                              title,
                body:                               body
            });


        },




        // |-------------------------------------------
        // | Miscellaneous functions
        // |-------------------------------------------
        // |
        // | Creates a modal with one button. The 
        // | button closes the modal on click.
        // |


        // Get height of modal
        repositionModal: function( modal ) {


            // Get dialog
            var dialog                          =   modal.find( ".modal-dialog" );


            // Show modal
            modal.show();


            // Get height
            var height                          =   dialog.outerHeight( true );


            // Adjust dialog
            dialog.css( "margin-top", "-" + ( height / 2 ) + "px" );


            // Hide modal
            modal.hide();


        },


        // Convert size
        getConvertedSize: function() {


            // Get configurations
            var config                          =   modalizr.config,
                size                            =   config.size,
                sizeClass                       =   "modal-";


            // Size has not been set - return
            if( ! size || size == "" ) return false;


            // Extra small
            if( size == "extra small" ) sizeClass += "xs";


            // Small
            else if( size == "small" ) sizeClass += "s";


            // Large
            else if( size == "large" ) sizeClass += "l";


            // Extra large
            else if( size == "extra large" ) sizeClass += "xl";


            // Full
            else if( size == "full" ) sizeClass += "full";


            // Return CSS class
            return sizeClass;


        }


    }